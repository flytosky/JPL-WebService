#!/usr/local/bin/octave -q

arg_list = argv();
printf ("%s", program_name());

narg = length(arg_list);

if narg < 2
  error('Insufficient argument, need a model and a variable name!'); 
end
modelName = lower(arg_list{1});
varName = lower(arg_list{2});

if narg > 2
  startTimeStr = arg_list{3};
  startTime = struct('year', str2num(startTimeStr(1:4)), 'month', str2num(startTimeStr(5:6)));
end

if narg > 3
  stopTimeStr = arg_list{4};
  stopTime = struct('year', str2num(stopTimeStr(1:4)), 'month', str2num(stopTimeStr(5:6)));
end

[center,model] = strtok(modelName, '_');
model = model(2:end); % get rid of '_'

dataDir = ['/home/zhai/cmip5/'  center '/' model '/']; 

dataFiles = dir([dataDir '/' varName '_*.nc']);

nDataFiles = length(dataFiles);

if nDataFiles < 1
  error(['Variable: ' varName ' for Model: ' modelName ' not found!']); 
end

dataFileFullPath = [];
idx = 1;
for ii = 1:nDataFiles
  thisFile = [dataDir '/' dataFiles(ii).name];
  if dataFileRelevant(thisFile, startTime, stopTime)
    dataFileFullPath{idx} = thisFile;
    idx = idx + 1;
  end
end

figFile = [modelName '_' varName '.jpeg'];
displayTwoDimClimatology(dataFileFullPath, figFile, varName, startTime, stopTime);
title([varName ' climatology for ' modelName]);
